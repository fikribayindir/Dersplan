<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DersPlan Pro</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        :root { --p: #1d4ed8; --bg: #f8fafc; --b: #e2e8f0; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); font-family: 'Inter', sans-serif; margin: 0; padding-top: 100px; color: #020617; }
        
        .header { position: fixed; top: 0; left: 0; right: 0; background: white; z-index: 100; border-bottom: 1px solid var(--b); }
        .brand { height: 40px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 18px; }
        .nav { display: flex; padding: 5px 10px; gap: 8px; }
        .nav-btn { flex: 1; height: 35px; border-radius: 8px; border: 1px solid var(--b); background: white; font-size: 12px; font-weight: 800; color: #64748b; cursor: pointer; }
        .nav-btn.active { background: var(--p); color: white; border-color: var(--p); }

        main { padding: 10px; max-width: 500px; margin: 0 auto; }
        .hidden { display: none !important; }

        .day-bar { display: flex; gap: 6px; overflow-x: auto; padding: 5px 0 10px; scrollbar-width: none; }
        .day-bar::-webkit-scrollbar { display: none; }
        .day-tab { padding: 8px 15px; border-radius: 10px; background: white; border: 1px solid var(--b); font-size: 13px; font-weight: 700; white-space: nowrap; flex-shrink: 0; }
        .day-tab.active { background: var(--p); color: white; }

        .card { background: white; border-radius: 12px; padding: 10px; margin-bottom: 8px; border: 1px solid var(--b); }
        .row { display: flex; align-items: center; gap: 8px; }
        .idx { color: var(--p); width: 20px; font-weight: 800; }
        .time { color: #64748b; width: 85px; font-size: 13px; font-weight: 600; }
        .cls { background: #eff6ff; color: var(--p); padding: 3px 6px; border-radius: 6px; font-size: 11px; font-weight: 800; min-width: 45px; text-align: center; }
        .ttl { flex: 1; font-weight: 700; font-size: 15px; text-transform: uppercase; }

        .grid-compact { display: grid; grid-template-columns: 70px 65px 1fr; gap: 5px; margin-top: 5px; }
        select, input { height: 34px; border-radius: 8px; border: 1px solid var(--b); padding: 0 5px; font-size: 13px; font-weight: 600; width: 100%; }
        label { font-size: 10px; font-weight: 800; color: #64748b; display: block; margin-bottom: 2px; }

        .btn-save { width: 100%; padding: 12px; border-radius: 10px; border: none; background: var(--p); color: white; font-weight: 800; margin-top: 10px; }
        .lock-box { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #fff5f5; border: 1px solid #fecaca; border-radius: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="brand">DERS<span>PLAN</span></div>
        <div class="nav">
            <button class="nav-btn active" id="btnH" onclick="tab('home')">PROGRAM</button>
            <button class="nav-btn" id="btnS" onclick="tab('settings')">AYARLAR</button>
        </div>
    </div>

    <main id="pH">
        <div class="day-bar" id="dBar"></div>
        <div id="list"></div>
    </main>

    <main id="pS" class="hidden">
        <div class="lock-box" id="lBox">
            <span style="font-size:12px; font-weight:800; color:#991b1b">DÜZENLEME KİLİDİ</span>
            <button onclick="toggleLock()" id="lBtn" style="padding:5px 10px; border-radius:6px; background:#f43f5e; color:white; border:none; font-weight:800; font-size:10px">KİLİDİ AÇ</button>
        </div>
        <div class="card">
            <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:5px">
                <div><label>Başla</label><input type="time" id="cSt" disabled></div>
                <div><label>Ders</label><input type="number" id="cDu" disabled></div>
                <div><label>Tenf</label><input type="number" id="cBr" disabled></div>
                <div><label>Öğle</label><input type="number" id="cLu" disabled></div>
            </div>
        </div>
        <div class="card">
            <label>GÜN SEÇ</label>
            <select id="bDay" disabled onchange="renderSets()"></select>
        </div>
        <div id="sList"></div>
        <button class="btn-save" id="sBtn" disabled onclick="save()">Kaydet ve Uygula</button>
    </main>

    <script>
        const days = ["Pazartesi", "Salı", "Çarşamba", "Perşembe", "Cuma", "Cumartesi", "Pazar"];
        const subs = ["A","B","C","D","E","F","G","H","I","J","K","L"];
        let db = JSON.parse(localStorage.getItem('dPlan')) || { s: [], c: { st: "08:15", du: 40, br: 10, lu: 45 } };
        let curD = days[0], locked = true;

        function tab(p) {
            document.getElementById('pH').classList.toggle('hidden', p !== 'home');
            document.getElementById('pS').classList.toggle('hidden', p !== 'settings');
            document.getElementById('btnH').classList.toggle('active', p === 'home');
            document.getElementById('btnS').classList.toggle('active', p === 'settings');
            p === 'home' ? renderHome() : renderSets();
        }

        function toggleLock() {
            locked = !locked;
            document.getElementById('lBtn').innerText = locked ? "KİLİDİ AÇ" : "KİLİTLE";
            document.getElementById('lBox').style.background = locked ? "#fff5f5" : "#f0fdf4";
            document.querySelectorAll('#pS input, #pS select, #sBtn').forEach(e => e.disabled = locked);
        }

        function getT() {
            let r = [], t = db.c.st;
            for(let i=1; i<=8; i++) {
                r.push(t);
                let [h, m] = t.split(':').map(Number);
                let d = new Date(); d.setHours(h, m + parseInt(db.c.du) + (i===4?parseInt(db.c.lu):parseInt(db.c.br)));
                t = String(d.getHours()).padStart(2,'0')+":"+String(d.getMinutes()).padStart(2,'0');
            }
            return r;
        }

        function renderHome() {
            const container = document.getElementById('list');
            const data = db.s.filter(x => x.d === curD).sort((a,b) => a.i - b.i);
            const times = getT();
            container.innerHTML = data.length ? data.map(x => `
                <div class="card" style="${x.e ? 'opacity:0.4' : ''}">
                    <div class="row">
                        <div class="idx">${x.i}</div>
                        <div class="time">${times[x.i-1]}</div>
                        <div class="cls">${x.e ? '-' : x.c}</div>
                        <div class="ttl">${x.l}</div>
                    </div>
                </div>`).join('') : '<div class="card" style="text-align:center;color:#94a3b8">Ders eklenmemiş.</div>';
        }

        function renderSets() {
            const container = document.getElementById('sList');
            const day = document.getElementById('bDay').value;
            let h = "";
            for(let i=1; i<=8; i++) {
                const x = db.s.find(z => z.d === day && z.i === i) || {};
                h += `<div class="card">
                    <div class="row" style="margin-bottom:5px">
                        <input type="checkbox" id="e-${i}" ${x.e?'checked':''} onchange="this.parentElement.nextElementSibling.style.opacity=this.checked?0.3:1" ${locked?'disabled':''}>
                        <label for="e-${i}" style="margin:0">Boş Ders</label>
                    </div>
                    <div class="grid-compact" style="${x.e?'opacity:0.3':''}">
                        <select id="v-${i}" ${locked?'disabled':''}>
                            <option value="">Sınıf</option>${[9,10,11,12].map(n=>`<option value="${n}" ${x.c?.split('-')[0]==n?'selected':''}>${n}</option>`).join('')}
                        </select>
                        <select id="u-${i}" ${locked?'disabled':''}>
                            <option value="">Şube</option>${subs.map(s=>`<option value="${s}" ${x.c?.split('-')[1]==s?'selected':''}>${s}</option>`).join('')}
                        </select>
                        <input id="l-${i}" placeholder="Ders Adı" value="${x.l||''}" ${locked?'disabled':''}>
                    </div>
                </div>`;
            }
            container.innerHTML = h;
        }

        function save() {
            db.c = { st: document.getElementById('cSt').value, du: document.getElementById('cDu').value, br: document.getElementById('cBr').value, lu: document.getElementById('cLu').value };
            const day = document.getElementById('bDay').value;
            db.s = db.s.filter(x => x.d !== day);
            for(let i=1; i<=8; i++) {
                const e = document.getElementById(`e-${i}`).checked;
                const l = document.getElementById(`l-${i}`).value;
                const v = document.getElementById(`v-${i}`).value;
                const u = document.getElementById(`u-${i}`).value;
                if(e) db.s.push({d:day, i, l:"BOŞ DERS", c:"-", e:true});
                else if(l) db.s.push({d:day, i, l, c:v+(u?'-'+u:''), e:false});
            }
            localStorage.setItem('dPlan', JSON.stringify(db));
            tab('home');
        }

        window.onload = () => {
            const bar = document.getElementById('dBar');
            const sel = document.getElementById('bDay');
            days.forEach(d => {
                const t = document.createElement('div');
                t.className = "day-tab" + (d===curD?" active":"");
                t.innerText = d;
                t.onclick = (e) => {
                    curD = d;
                    document.querySelectorAll('.day-tab').forEach(x => x.classList.toggle('active', x.innerText===d));
                    renderHome();
                    e.target.scrollIntoView({ behavior: 'smooth', inline: 'center' });
                };
                bar.appendChild(t);
                sel.innerHTML += `<option>${d}</option>`;
            });
            document.getElementById('cSt').value = db.c.st;
            document.getElementById('cDu').value = db.c.du;
            document.getElementById('cBr').value = db.c.br;
            document.getElementById('cLu').value = db.c.lu;
            renderHome();
        };
    </script>
</body>
</html>
